package cn.sirbox.controller;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import cn.sirbox.model.Releaseinfo;
import cn.sirbox.model.UserU;
import cn.sirbox.service.ReleaseinfoService;

@Controller
@RequestMapping("/releaseinfo")
public class ReleaseinfoController {

	@Autowired
	private ReleaseinfoService releaseinfoService;

	// 查询所有发布信息
	@RequestMapping(value = "/editAll", method = RequestMethod.GET)
	public String editAllReleaseinfo(Model model) throws Exception {

		List<Releaseinfo> riList = releaseinfoService.findAll();
		model.addAttribute("riList", riList);
		return "releaseinfo/releaseinfolist";
	}

	// 跳转添加页面
	@RequestMapping("/toAdd")
	public String toAddReleaseinfo(Model modle) {
		// 开启modeldriven
		modle.addAttribute(new Releaseinfo());
		return "releaseinfo/addreleaseinfo";
	}

	// 添加信息
	@RequestMapping("/add")
	public String addReleaseinfo(Releaseinfo releaseinfo, HttpServletRequest request) throws Exception {
		
		UserU userU = (UserU) request.getSession().getAttribute("userU");
		releaseinfo.setIssuer(userU.getUname());
		releaseinfoService.add(releaseinfo);
		return "redirect:editAll.do";
	}

	
	// 跳转更新页面
	@RequestMapping("/toUpdate")
	public String updateReleaseinfo(Integer id, Model model) throws Exception {

		Releaseinfo releaseinfo = releaseinfoService.findById(id);
		model.addAttribute(releaseinfo);
		return "releaseinfo/updatereleaseinfo";
	}

	// 更新信息
	@RequestMapping("/update")
	public String updateReleaseinfo(Releaseinfo releaseinfo) throws Exception {

		releaseinfoService.update(releaseinfo);
		return "redirect:editAll.do";
	}
	
	// 删除信息
	@RequestMapping("/delete")
	public String deleteReleaseinfo(Integer id) throws Exception {

		releaseinfoService.delete(id);
		return "redirect:editAll.do";
	}

	// 查看单个发布信息
	@RequestMapping("/check")
	public String findById(Integer id, Model model) throws Exception {

		Releaseinfo releaseinfo = releaseinfoService.findById(id);
		model.addAttribute(releaseinfo);
		return "releaseinfo/checkreleaseinfo";
	}

	// 批量审批通过
	@RequestMapping("/edits")
	public String updateReleaseinfos(Integer[] id,String str) throws Exception {

		releaseinfoService.update(id,str);
		return "redirect:editAll.do";
	}

	// 跳转审批页面
	@RequestMapping("/shenhe")
	public String toUpdate(Integer id, Model model) throws Exception {

		Releaseinfo releaseinfo = releaseinfoService.findById(id);
		model.addAttribute(releaseinfo);
		return "releaseinfo/shenpireleaseinfo";

	}

	// 根据审核状态查询发布信息
	@RequestMapping("/edit")
	public String editReleaseinfo(Integer state,Model model) throws Exception {
		
		List<Releaseinfo> riList = releaseinfoService.findByState(state);
		model.addAttribute("riList", riList);
		return "releaseinfo/releaseinfolist";
	}
	
	//根据行业查询发布信息
	@RequestMapping("/findByIB")
	public String editReleaseinfo(String itemBusiness , Model model) throws Exception{
		
		List<Releaseinfo> riList = releaseinfoService.findByName(itemBusiness);
		model.addAttribute("riList", riList);
		return "releaseinfo/releaseinfolist";
		
	}

}
