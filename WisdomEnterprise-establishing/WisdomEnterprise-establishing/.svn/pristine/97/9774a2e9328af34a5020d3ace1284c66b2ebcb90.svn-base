<%@ page contentType="text/html;charset=UTF-8" language="java"  pageEncoding="UTF-8"%>
<html>
<head>
  <title>主页</title>


    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/basestyle.css">
    <script src="/js/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="/css/moment.js"></script>
</head>
<body>
欢迎用户：${userU.uname}
<button id="all">查询所有用户</button>


<table id="table1" class="table">
</table>
</body>
<script>


    $("#all").click(function () {
        $.post("${pageContext.request.contextPath}/user/all.do",{
            thispage:0
        },function (data) {
            if(data.status==1){
                alert(data.msg)
            }
            var json = eval(data.json); //数组
            var th='<tr> <th>姓名</th> <th>年龄</th> <th>性别</th> <th>操作</th> </tr>';
            $("#table1").append(th);
            $("#table1  tr:not(:first)").html("");
            $.each(json, function (index) {
                //循环获取数据
                var name = json[index].uname;
                var age = json[index].uage;
                var sex = json[index].usex;

                var tr = '<tr><td>'+name+'</td><td>'+age+'</td><td>'+sex+'</td><td><a href="${pageContext.request.contextPath}/user/updata.do?uid='+json[index].uid+'">编辑</a><button onclick="dele('+json[index].uid+','+data.thispage+')">删除</button></td></tr>';
                $("#table1").append(tr);
            });
            var td='<tr><td></td><td><button id="up" onclick="up('+data.thispage+')">上一页</button><button id="down" onclick="down('+data.thispage+')">下一页</button>共'+(data.thispage+1)+'/'+data.page+'页</td><td></td></tr>';
            $("#table1").append(td);
        });
    })


    function up(thispage) {

        if(thispage!=0){
            thispage=thispage-1;
        }

        $.post("${pageContext.request.contextPath}/user/all.do",{
            thispage:thispage
        },function (data) {
            if(data.status==1){
                alert(data.msg)
            }
            var json = eval(data.json); //数组


            $("#table1  tr:not(:first)").html("");
            $.each(json, function (index) {
                //循环获取数据
                var name = json[index].uname;
                var age = json[index].uage;
                var sex = json[index].usex;

                var tr =  '<tr><td>'+name+'</td><td>'+age+'</td><td>'+sex+'</td><td><a href="${pageContext.request.contextPath}/user/updata.do?uid='+json[index].uid+'">编辑</a><button onclick="dele('+json[index].uid+','+data.thispage+')">删除</button></td></tr>';
                $("#table1").append(tr);
            });
            var td='<tr><td></td><td><button id="up" onclick="up('+data.thispage+')">上一页</button><button id="down" onclick="down('+data.thispage+')">下一页</button>共'+(data.thispage+1)+'/'+data.page+'页</td><td></td></tr>';
            $("#table1").append(td);

        });

    }
    function down(thispage) {

        thispage=thispage+1;
        $.post("${pageContext.request.contextPath}/user/all.do",{
            thispage:thispage
        },function (data) {
            if(data.status==1){
                alert(data.msg)
            }
            var json = eval(data.json); //数组


            $("#table1  tr:not(:first)").html("");
            $.each(json, function (index) {
                //循环获取数据
                var name = json[index].uname;
                var age = json[index].uage;
                var sex = json[index].usex;

                var tr = '<tr><td>'+name+'</td><td>'+age+'</td><td>'+sex+'</td><td><a href="${pageContext.request.contextPath}/user/updata.do?uid='+json[index].uid+'">编辑</a><button onclick="dele('+json[index].uid+','+data.thispage+')">删除</button></td></tr>';
                $("#table1").append(tr);
            });
            var td='<tr><td></td><td><button id="up" onclick="up('+data.thispage+')">上一页</button><button id="down" onclick="down('+data.thispage+')">下一页</button>共'+(data.thispage+1)+'/'+data.page+'页</td><td></td></tr>';
            $("#table1").append(td);

        });

    }
    function dele(uid,thispage) {

        $.post("${pageContext.request.contextPath}/user/dele.do",{
            uid:uid,
            thispage:thispage
        },function (data) {

            down((data-1))

        });

    }




</script>
</html>
